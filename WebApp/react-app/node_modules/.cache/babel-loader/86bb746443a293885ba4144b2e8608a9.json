{"ast":null,"code":"\"use strict\";\n/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\n\nfunction __export(m) {\n  for (var p in m) {\n    if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n  }\n}\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar Analytics_1 = require(\"./Analytics\");\n\nexports.AnalyticsClass = Analytics_1.default;\n\nvar core_1 = require(\"@aws-amplify/core\");\n\nvar logger = new core_1.ConsoleLogger('Analytics');\nvar endpointUpdated = false;\nvar authConfigured = false;\nvar analyticsConfigured = false;\nvar _instance = null;\n\nif (!_instance) {\n  logger.debug('Create Analytics Instance');\n  _instance = new Analytics_1.default();\n}\n\nvar Analytics = _instance;\ncore_1.default.register(Analytics);\nexports.default = Analytics;\n\n__export(require(\"./Providers\"));\n\nvar listener = function listener(capsule) {\n  var channel = capsule.channel,\n      payload = capsule.payload,\n      source = capsule.source;\n  logger.debug('on hub capsule ' + channel, payload);\n\n  switch (channel) {\n    case 'auth':\n      authEvent(payload);\n      break;\n\n    case 'storage':\n      storageEvent(payload);\n      break;\n\n    case 'analytics':\n      analyticsEvent(payload);\n      break;\n\n    default:\n      break;\n  }\n};\n\nvar storageEvent = function storageEvent(payload) {\n  var _a = payload.data,\n      attrs = _a.attrs,\n      metrics = _a.metrics;\n  if (!attrs) return;\n  Analytics.record({\n    name: 'Storage',\n    attributes: attrs,\n    metrics: metrics\n  });\n};\n\nvar authEvent = function authEvent(payload) {\n  var event = payload.event;\n\n  if (!event) {\n    return;\n  }\n\n  switch (event) {\n    case 'signIn':\n      Analytics.record({\n        name: '_userauth.sign_in'\n      });\n      break;\n\n    case 'signUp':\n      Analytics.record({\n        name: '_userauth.sign_up'\n      });\n      break;\n\n    case 'signOut':\n      break;\n\n    case 'signIn_failure':\n      Analytics.record({\n        name: '_userauth.auth_fail'\n      });\n      break;\n\n    case 'configured':\n      authConfigured = true;\n\n      if (authConfigured && analyticsConfigured) {\n        var config = Analytics.configure();\n\n        if (!endpointUpdated && config['autoSessionRecord']) {\n          Analytics.updateEndpoint({}).catch(function (e) {\n            logger.debug('Failed to update the endpoint', e);\n          });\n        }\n\n        Analytics.autoTrack('session', {\n          enable: Analytics.configure()['autoSessionRecord']\n        });\n        endpointUpdated = true;\n      }\n\n      break;\n  }\n};\n\nvar analyticsEvent = function analyticsEvent(payload) {\n  var event = payload.event;\n  if (!event) return;\n\n  switch (event) {\n    case 'pinpointProvider_configured':\n      analyticsConfigured = true;\n\n      if (authConfigured && analyticsConfigured) {\n        var config = Analytics.configure();\n\n        if (!endpointUpdated && config['autoSessionRecord']) {\n          Analytics.updateEndpoint({}).catch(function (e) {\n            logger.debug('Failed to update the endpoint', e);\n          });\n        }\n\n        Analytics.autoTrack('session', {\n          enable: config['autoSessionRecord']\n        });\n        endpointUpdated = true;\n      }\n\n      break;\n  }\n};\n\ncore_1.Hub.listen('auth', listener);\ncore_1.Hub.listen('storage', listener);\ncore_1.Hub.listen('analytics', listener);","map":null,"metadata":{},"sourceType":"script"}